package codegears.DEPuzzles.ui;

import freehand.neandroid.util.Timer;
import android.content.Context;
import android.util.AttributeSet;
import android.widget.Button;

public class TimerButton extends Button {

	private Timer timer;
	private TimerThread thread;

	public TimerButton(Context context, AttributeSet attrs) {
		super(context, attrs);
		timer = new Timer();
	}

	public void start() {
		if (thread != null) {
			thread.setStop();
		}
		thread = new TimerThread(timer);
		timer.start();
		thread.start();
	}

	public void stop() {
		thread.setStop();
		thread = null;
	}
	
	public void setTime(int time){
		TimerButton.this.post(new Runnable() {
			@Override
			public void run() {
				TimerButton.this.setText(String.valueOf(timer.getDuration()));
				TimerButton.this.invalidate();
			}

		});
	}

	private class TimerThread extends Thread {

		private Timer timer;
		private boolean stop;

		public TimerThread(Timer timer) {
			stop = false;
			this.timer = timer;
		}

		public void setStop() {
			stop = true;
		}

		@Override
		public void run() {
			while (!stop) {
				timer.update();
				TimerButton.this.setTime(timer.getDuration());
				try {
					sleep(5);
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
				System.out.println("Thread");
			}
		}
	}
}